function startRead()
{
  // obtain input element through DOM

  var file = document.getElementById('file').files[0];
  if(file)
	{
    getAsText(file);
  }
}

function getAsText(readFile)
{
	var reader;
	try
	{
    reader = new FileReader();
	}catch(e)
	{
		document.getElementById('output').innerHTML =
			"Error: seems File API is not supported on your browser";
	  return;
  }

  // Read file into memory as UTF-8
  reader.readAsText(readFile, "UTF-8");

  // Handle progress, success, and errors
  reader.onload = loaded;
  reader.onerror = errorHandler;
}

var fileString = "";
function loaded(evt)
{
  // Obtain the read file data
  fileString = evt.target.result;
  fileString = fileString.split("\n");
  for(var i=0; i < fileString.length; i++) {
    document.getElementById('output').innerHTML += (fileString[i] + "\n");
  }

}

function errorHandler(evt)
{
  if(evt.target.error.code == evt.target.error.NOT_READABLE_ERR)
	{
    // The file could not be read
		document.getElementById('output').innerHTML = "Error reading file..."
  }
}
$(document).ready(function() {
					$body = $("body");
					$(document).on({
					    ajaxStart: function() { $body.addClass("loading"); },
					    ajaxStop: function() { $body.removeClass("loading"); }
					});
            $('[data-toggle="tooltip"]').tooltip();
	$("#confirmButton").on("click", function() {
                    if (document.getElementById('file').files[0]) {
                        $("#box").hide();
                    };

var listz = []
for(var i=0; i < fileString.length; i++) {
		var input = fileString[i];

		//var root = 'http://localhost:3000';
		var root = 'http://sniphunter.sanbi.ac.za';

		$.ajax({
	  	url: root + '/PMCOAI_rs_articles?rs_number=' + input,
	 	method: 'GET'
		}).then(function(data) {

		for(var i=0; i < data.length; i++) {

			var elem = document.createElement("a");

			    rsID = data[i].rs_number;

				cited = data[i].rs_number_cited_in_article;

				pub = data[i].pubmed_id;
				if (pub ==	"not available") {
				pub = "N/A";
				};

				year = data[i].publication_date;
				if (year ==	"not available") {
				year = "N/A";
				};

				doi = data[i].doi;
				if (doi ==	"not available") {
				doi = "N/A";
				};

				email = data[i].email_address;
				if (email == "not available") {
				email = "N/A";
				};

				title = data[i].article_title;
				if (title == "not available") {
				title = "<Please click for title>";
				};

			var textnode1 = document.createTextNode("SNP identifier " + rsID + " was mentioned at least "
				+ cited + " time(s) in an article entitled ");
			var titlenode = document.createTextNode(title);
			var textnode2 = document.createTextNode(" published in " + year +
				". The article has been tagged with Digital Object Identifier (DOI) " +  doi +
				" and Pubmed Central ID " + pub +
				". For more information contact the correspondence author at "); 
			var textnode3 = document.createTextNode(email);
			var textnode4 = document.createTextNode(" or");
			var textnode5 = document.createTextNode(" click here to view functional information.");

			elem.appendChild(textnode1);
			elem.title = "Read the full paper";
			elem.id = "updated";

			var emailer = document.createElement('a');
			emailer.style.color = "Royalblue";
			emailer.title = "Email correspondence author";
			emailer.href = "mailto:" + email;
			emailer.target = "_blank"
			emailer.appendChild(textnode3);

			var func = document.createElement('a');
			func.style.color = "Royalblue";
			func.title = "View functional information";
			func.href = "http://www.ncbi.nlm.nih.gov/snp/?term=" + pub;
			func.target = "_blank"
			func.appendChild(textnode5);

			var span = document.createElement('a');
			span.style.color = "Royalblue";
			span.title = "Read the full paper";
			span.style.fontStyle = "italic";
			span.href = "http://www.ncbi.nlm.nih.gov/pmc/?term=" + pub;
			span.target = "_blank"
			span.appendChild(titlenode);
			elem.appendChild(span);
			elem.appendChild(textnode2);
			elem.appendChild(emailer);
			elem.appendChild(textnode4);
			elem.appendChild(func);

			listz.push([cited, elem]);
			listz.sort(function(a, b){return a[0]-b[0]});

			};

			if (listz.length == 0) {
				var elem = document.createElement("h4");
				var noresults = document.createTextNode("\"" + input + "\"" + " did not match anything in the database");
				elem.appendChild(noresults);
				$("rs").append(elem);
			    };

			while (listz.length != 0) {
			readyToGo = listz.pop();
			readyToGo = readyToGo.concat();
			$("rs").append(readyToGo[1]);
			$("[id=updated]").addClass("btn btn-default updateSpecs");
			};

			});



				}
	});

        $("#clearButton").on("click", function() {
                $("#divz").children().empty();
                $("#box").show();
                document.getElementById('output').innerHTML = null;
                $("#fileform")[0].reset();
                fileString = null;
            });
});


